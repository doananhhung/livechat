<!doctype html>
<html lang="vi">
<head>
  <script>
    // Load head (meta + links)
    fetch('../shared/head.html')
      .then(r => r.text())
      .then(html => {
        document.head.insertAdjacentHTML('afterbegin', html);
      });
    
    // Load styles
    fetch('../shared/styles.html')
      .then(r => r.text())
      .then(html => {
        document.head.insertAdjacentHTML('beforeend', html);
      });
  </script>
  <title>Ch∆∞∆°ng 4: B·∫£o M·∫≠t API & WebSocket</title>
</head>
<body>
  <div class="reveal">
    <div class="slides">
      <section>
        <!-- Slide 1: Ti√™u ƒë·ªÅ -->
        <section>
          <h1 class="chapter-title">B·∫£o M·∫≠t API & WebSocket</h1>
          <p style="font-size: 0.8em; margin-top: 2em;">Ng∆∞·ªùi tr√¨nh b√†y: ƒêinh Vi·ªát Ho√†ng</p>
          <aside class="notes">
            <p><strong>Ch∆∞∆°ng tr√¨nh:</strong></p>
            <ol>
              <li>T·ªïng quan v·ªÅ B·∫£o m·∫≠t Endpoint</li>
              <li>B·∫£o m·∫≠t REST API (T√≥m t·∫Øt)</li>
              <li>Th√°ch th·ª©c c·ªßa B·∫£o m·∫≠t WebSocket</li>
              <li>Ki·∫øn tr√∫c B·∫£o m·∫≠t WebSocket 3 L·ªõp</li>
              <li>Lu·ªìng k·∫øt n·ªëi v√≠ d·ª• (Agent vs. Widget)</li>
            </ol>
          </aside>
        </section>

        <!-- Slide 2: B·∫£o m·∫≠t REST API -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 20v-2a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 20v-2a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M18 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>B·∫£o m·∫≠t REST API</h2>
                        <p style="font-size: 0.7em; margin-top: 1em; opacity: 0.8;">Ph√≤ng th·ªß theo chi·ªÅu s√¢u</p>
                    </div>
                    <div class="right-column">
                        <table style="font-size: 0.75em; width: 100%;">
                            <thead>
                                <tr>
                                    <th style="text-align: left;">Bi·ªán ph√°p</th>
                                    <th style="text-align: left;">C√¥ng c·ª•</th>
                                    <th style="text-align: left;">Ch·ª©c nƒÉng</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Authentication</strong></td>
                                    <td><code>jwt.guard.ts</code></td>
                                    <td>X√°c th·ª±c JWT cho m·ªçi request</td>
                                </tr>
                                <tr>
                                    <td><strong>Authorization</strong></td>
                                    <td><code>roles.guard.ts</code></td>
                                    <td>Ph√¢n quy·ªÅn theo vai tr√≤</td>
                                </tr>
                                <tr>
                                    <td><strong>Input Validation</strong></td>
                                    <td><code>ValidationPipe</code></td>
                                    <td>X√°c th·ª±c & l√†m s·∫°ch DTOs</td>
                                </tr>
                                <tr>
                                    <td><strong>CORS</strong></td>
                                    <td><code>app.enableCors()</code></td>
                                    <td>Ki·ªÉm so√°t domain ngu·ªìn</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <aside class="notes">
                <p>B·∫£o m·∫≠t cho c√°c API RESTful c·ªßa ch√∫ng ta ƒë∆∞·ª£c x√¢y d·ª±ng tr√™n b·ªën tr·ª• c·ªôt ch√≠nh, t·∫°o th√†nh m·ªôt h·ªá th·ªëng ph√≤ng th·ªß theo chi·ªÅu s√¢u:</p>
                <ul>
                    <li><strong>Authentication (jwt.guard.ts):</strong> ƒê·∫£m b·∫£o m·ªçi request (tr·ª´ c√°c endpoint ƒë∆∞·ª£c ƒë√°nh d·∫•u @Public) ph·∫£i c√≥ m·ªôt JWT h·ª£p l·ªá trong header Authorization.</li>
                    <li><strong>Authorization (roles.guard.ts):</strong> Sau khi x√°c th·ª±c, guard n√†y s·∫Ω th·ª±c thi vi·ªác ph√¢n quy·ªÅn d·ª±a tr√™n vai tr√≤ (c·∫£ GlobalRole v√† ProjectRole) cho c√°c endpoint ƒë∆∞·ª£c ƒë√°nh d·∫•u @Roles().</li>
                    <li><strong>Input Validation (ValidationPipe):</strong> ƒê∆∞·ª£c √°p d·ª•ng to√†n c·ª•c, ValidationPipe t·ª± ƒë·ªông x√°c th·ª±c v√† l√†m s·∫°ch d·ªØ li·ªáu DTOs ƒë·∫øn, b·∫£o v·ªá h·ªá th·ªëng kh·ªèi d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá v√† c√°c cu·ªôc t·∫•n c√¥ng injection c∆° b·∫£n.</li>
                    <li><strong>CORS (app.enableCors()):</strong> Ki·ªÉm so√°t ch·∫∑t ch·∫Ω c√°c domain n√†o t·ª´ ph√≠a tr√¨nh duy·ªát ƒë∆∞·ª£c ph√©p g·ª≠i request ƒë·∫øn API, ngƒÉn ch·∫∑n c√°c cu·ªôc t·∫•n c√¥ng Cross-Site Request Forgery (CSRF) ƒë∆°n gi·∫£n.</li>
                </ul>
            </aside>
        </section>

        <!-- Slide 3: Th√°ch th·ª©c WebSocket -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 22v-2M14 22v-2M10 22h4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 20a4.002 4.002 0 0 0 4-4V8a4 4 0 1 0-8 0v8a4.002 4.002 0 0 0 4 4Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 8v8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Th√°ch th·ª©c WebSocket</h2>
                    </div>
                    <div class="right-column">
                        <div style="margin-bottom: 1.5em;">
                            <h4 style="color: #3b82f6; margin-bottom: 0.5em;">REST API: Stateless</h4>
                            <p style="font-size: 0.75em;">M·ªói request l√† giao d·ªãch ƒë·ªôc l·∫≠p. X√°c th·ª±c tr√™n t·ª´ng request v·ªõi JWT trong header.</p>
                        </div>
                        <div style="margin-bottom: 1.5em;">
                            <h4 style="color: #ef4444; margin-bottom: 0.5em;">WebSocket: Stateful</h4>
                            <p style="font-size: 0.75em;">K·∫øt n·ªëi b·ªÅn v·ªØng, x√°c th·ª±c <strong>m·ªôt l·∫ßn</strong> l√∫c handshake. To√†n b·ªô phi√™n ph·∫£i ƒë∆∞·ª£c b·∫£o v·ªá.</p>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1em; border-radius: 8px;">
                            <h5 style="margin-bottom: 0.5em;">Hai lo·∫°i Client:</h5>
                            <ul style="font-size: 0.75em; margin: 0;">
                                <li><strong>ƒê√£ x√°c th·ª±c:</strong> Agent/Manager (c√≥ JWT)</li>
                                <li><strong>·∫®n danh:</strong> Widget Kh√°ch h√†ng (kh√¥ng c√≥ JWT)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                <p><strong>T·∫°i sao WebSocket c·∫ßn m·ªôt m√¥ h√¨nh b·∫£o m·∫≠t ri√™ng?</strong></p>
                <p>Kh√¥ng gi·ªëng nh∆∞ REST API, WebSocket c√≥ nh·ªØng ƒë·∫∑c th√π ri√™ng ƒë√≤i h·ªèi m·ªôt ph∆∞∆°ng ph√°p ti·∫øp c·∫≠n b·∫£o m·∫≠t kh√°c bi·ªát.</p>
                <ul>
                    <li><strong>REST API: Stateless (Phi tr·∫°ng th√°i)</strong> - M·ªói request HTTP l√† m·ªôt giao d·ªãch ƒë·ªôc l·∫≠p, t·ª± ch·ª©a. Client g·ª≠i m·ªôt request, server x·ª≠ l√Ω v√† tr·∫£ v·ªÅ m·ªôt response, sau ƒë√≥ k·∫øt n·ªëi ƒë√≥ng l·∫°i. Vi·ªác x√°c th·ª±c ƒë∆∞·ª£c th·ª±c hi·ªán tr√™n t·ª´ng request b·∫±ng c√°ch g·ª≠i JWT trong header.</li>
                    <li><strong>WebSocket: Stateful (C√≥ tr·∫°ng th√°i)</strong> - Client v√† server thi·∫øt l·∫≠p m·ªôt k·∫øt n·ªëi b·ªÅn v·ªØng (persistent connection). K·∫øt n·ªëi n√†y ƒë∆∞·ª£c duy tr√¨ ƒë·ªÉ cho ph√©p giao ti·∫øp hai chi·ªÅu b·∫•t c·ª© l√∫c n√†o. Do ƒë√≥, vi·ªác x√°c th·ª±c ch·ªâ c·∫ßn th·ª±c hi·ªán M·ªòT L·∫¶N v√†o l√∫c b·∫Øt ƒë·∫ßu k·∫øt n·ªëi (handshake). To√†n b·ªô phi√™n k·∫øt n·ªëi sau ƒë√≥ ph·∫£i ƒë∆∞·ª£c b·∫£o v·ªá.</li>
                </ul>
                <p><strong>Hai lo·∫°i Client c·ªßa H·ªá th·ªëng:</strong></p>
                <p>Ki·∫øn tr√∫c c·ªßa ch√∫ng ta ph·∫£i h·ªó tr·ª£ ƒë·ªìng th·ªùi hai lo·∫°i client c√≥ nhu c·∫ßu b·∫£o m·∫≠t ho√†n to√†n kh√°c nhau:</p>
                <ol>
                    <li><strong>Ng∆∞·ªùi d√πng ƒë√£ x√°c th·ª±c (Authenticated Users):</strong> L√† c√°c Agent ho·∫∑c Manager s·ª≠ d·ª•ng ·ª©ng d·ª•ng web ch√≠nh c·ªßa ch√∫ng ta. H·ªç C√ì JWT sau khi ƒëƒÉng nh·∫≠p v√† c·∫ßn ƒë∆∞·ª£c ph√¢n quy·ªÅn ƒë·ªÉ truy c·∫≠p d·ªØ li·ªáu c·ªßa c√°c d·ª± √°n c·ª• th·ªÉ.</li>
                    <li><strong>Kh√°ch truy c·∫≠p ·∫©n danh (Anonymous Visitors):</strong> L√† nh·ªØng ng∆∞·ªùi d√πng cu·ªëi t∆∞∆°ng t√°c v·ªõi widget tr√≤ chuy·ªán ƒë∆∞·ª£c nh√∫ng tr√™n c√°c trang web c·ªßa kh√°ch h√†ng. H·ªç KH√îNG C√ì JWT v√† ph·∫£i ƒë∆∞·ª£c ph√©p k·∫øt n·ªëi ƒë·ªÉ b·∫Øt ƒë·∫ßu m·ªôt cu·ªôc tr√≤ chuy·ªán.</li>
                </ol>
            </aside>
        </section>

        <!-- Slide 4: Ki·∫øn tr√∫c 3 L·ªõp -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/><path d="M12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke-width="1.5"/><path d="M12 12c-2.5 0-2.5-4-2.5-4M12 12c2.5 0 2.5-4 2.5-4M12 12c-2.5 0-2.5 4-2.5 4M12 12c2.5 0 2.5 4 2.5 4" stroke-width="1.5" stroke-linecap="round"/></svg>
                        <h2>Ki·∫øn tr√∫c 3 L·ªõp</h2>
                        <p style="font-size: 0.7em; margin-top: 1em; opacity: 0.8;">Ph√≤ng th·ªß theo chi·ªÅu s√¢u cho WebSocket</p>
                        <div style="margin-top: 2em; font-size: 0.7em; text-align: left;">
                            <div style="margin-bottom: 0.8em; padding: 0.5em; background: rgba(59, 130, 246, 0.1); border-left: 3px solid #3b82f6;">
                                <strong>1. Domain Whitelist</strong><br/>
                                <span style="opacity: 0.8;">Ch·∫∑n domain l·∫°</span>
                            </div>
                            <div style="margin-bottom: 0.8em; padding: 0.5em; background: rgba(16, 185, 129, 0.1); border-left: 3px solid #10b981;">
                                <strong>2. User Authentication</strong><br/>
                                <span style="opacity: 0.8;">X√°c ƒë·ªãnh danh t√≠nh</span>
                            </div>
                            <div style="padding: 0.5em; background: rgba(245, 158, 11, 0.1); border-left: 3px solid #f59e0b;">
                                <strong>3. Room Authorization</strong><br/>
                                <span style="opacity: 0.8;">C√¥ l·∫≠p d·ªØ li·ªáu d·ª± √°n</span>
                            </div>
                        </div>
                    </div>
                    <div class="right-column">
                        <div class="mermaid" style="font-size: 0.8em;">
                            graph TD
                                A[K·∫øt n·ªëi WebSocket ƒë·∫øn] --> B{L·ªõp 1: Whitelisting Domain};
                                B -- "Origin h·ª£p l·ªá" --> C{L·ªõp 2: User Authentication};
                                C -- "ƒê√£ x√°c th·ª±c ho·∫∑c ·∫®n danh" --> D{L·ªõp 3: Room Authorization};
                                D -- "ƒê√£ tham gia Room" --> E[K·∫øt n·ªëi th√†nh c√¥ng v√† an to√†n];
                                B -- "Origin KH√îNG h·ª£p l·ªá" --> F[T·ª´ ch·ªëi k·∫øt n·ªëi];
                                C -- "Token KH√îNG h·ª£p l·ªá" --> F;
                                style E fill:#10b981,stroke:#333,stroke-width:2px,color:#fff
                                style F fill:#ef4444,stroke:#333,stroke-width:2px,color:#fff
                                style A fill:#3b82f6,stroke:#333,stroke-width:2px,color:#fff
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                <p><strong>M·ªôt m√¥ h√¨nh ph√≤ng th·ªß theo chi·ªÅu s√¢u cho giao ti·∫øp th·ªùi gian th·ª±c</strong></p>
                <p>ƒê·ªÉ gi·∫£i quy·∫øt c√°c th√°ch th·ª©c tr√™n, ch√∫ng ta ƒë√£ x√¢y d·ª±ng m·ªôt m√¥ h√¨nh b·∫£o m·∫≠t g·ªìm 3 l·ªõp ri√™ng bi·ªát. M·ªçi k·∫øt n·ªëi WebSocket ƒë·ªÅu ph·∫£i ƒëi qua c·∫£ 3 l·ªõp n√†y.</p>
                <ol>
                    <li>
                        <strong>L·ªõp 1: Whitelisting Domain (RedisIoAdapter)</strong>
                        <ul>
                            <li><strong>M·ª•c ti√™u:</strong> NgƒÉn ch·∫∑n c√°c trang web l·∫° k·∫øt n·ªëi.</li>
                            <li><strong>C∆° ch·∫ø:</strong> Ki·ªÉm tra header 'origin' c·ªßa k·∫øt n·ªëi. Ch·ªâ cho ph√©p c√°c k·∫øt n·ªëi t·ª´ frontend ch√≠nh c·ªßa ch√∫ng ta, ho·∫∑c t·ª´ m·ªôt domain ƒë√£ ƒë∆∞·ª£c ch·ªß d·ª± √°n th√™m v√†o "danh s√°ch tr·∫Øng" (whitelisted domains) trong c√†i ƒë·∫∑t.</li>
                        </ul>
                    </li>
                    <li>
                        <strong>L·ªõp 2: User Authentication (WsJwtAuthGuard)</strong>
                        <ul>
                            <li><strong>M·ª•c ti√™u:</strong> X√°c ƒë·ªãnh danh t√≠nh c·ªßa ng∆∞·ªùi d√πng (n·∫øu c√≥).</li>
                            <li><strong>C∆° ch·∫ø:</strong> Ki·ªÉm tra s·ª± t·ªìn t·∫°i c·ªßa JWT trong handshake.auth.token.
                                <ul>
                                    <li>N·∫øu c√≥ token (Agent/Manager), guard s·∫Ω x√°c th·ª±c n√≥ v√† g·∫Øn th√¥ng tin 'user' v√†o socket.</li>
                                    <li>N·∫øu kh√¥ng c√≥ token (Widget ·∫©n danh), guard cho ph√©p k·∫øt n·ªëi ƒëi ti·∫øp.</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <strong>L·ªõp 3: Room-Based Authorization (EventsGateway)</strong>
                        <ul>
                            <li><strong>M·ª•c ti√™u:</strong> ƒê·∫£m b·∫£o ng∆∞·ªùi d√πng ch·ªâ nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu h·ªç ƒë∆∞·ª£c ph√©p xem.</li>
                            <li><strong>C∆° ch·∫ø:</strong> M·ªôt k·∫øt n·ªëi sau khi ƒë∆∞·ª£c x√°c th·ª±c v·∫´n ch∆∞a c√≥ quy·ªÅn truy c·∫≠p d·ªØ li·ªáu n√†o. Client ph·∫£i g·ª≠i m·ªôt event 'joinProjectRoom' ƒë·ªÉ tham gia v√†o m·ªôt "room" c·ª• th·ªÉ c·ªßa d·ª± √°n (v√≠ d·ª•: 'project:123'). Server ch·ªâ ph√°t c√°c s·ª± ki·ªán v√† tin nh·∫Øn t·ªõi c√°c th√†nh vi√™n trong room ƒë√≥, ƒë·∫£m b·∫£o d·ªØ li·ªáu ƒë∆∞·ª£c c√¥ l·∫≠p ho√†n to√†n gi·ªØa c√°c d·ª± √°n.</li>
                        </ul>
                    </li>
                </ol>
            </aside>
        </section>

        <!-- Slide 5: Lu·ªìng k·∫øt n·ªëi v√≠ d·ª• -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 16.99v-1.5a3.5 3.5 0 0 0-3.5-3.5H3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 7.01v1.5a3.5 3.5 0 0 0 3.5 3.5H21" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="m6 12 3-3-3-3M18 12l-3 3 3 3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Lu·ªìng k·∫øt n·ªëi v√≠ d·ª•</h2>
                        <p style="font-size: 0.7em; margin-top: 1em; opacity: 0.8;">So s√°nh Agent vs Widget</p>
                    </div>
                    <div class="right-column">
                        <div style="display: flex; justify-content: space-around; gap: 1em;">
                            <div style="flex: 1; text-align: center; background: rgba(59, 130, 246, 0.05); padding: 1em; border-radius: 8px;">
                                <h5 style="color: #3b82f6; margin-bottom: 0.8em;">üîê Agent ƒêƒÉng nh·∫≠p</h5>
                                <div class="mermaid" style="font-size: 0.65em;">
                                    sequenceDiagram
                                        participant Client as Agent App
                                        participant L1 as L·ªõp 1
                                        participant L2 as L·ªõp 2
                                        participant L3 as L·ªõp 3
                                        
                                        Client->>L1: K·∫øt n·ªëi (c√≥ JWT)
                                        activate L1
                                        L1-->>Client: ‚úì Origin OK
                                        deactivate L1
                                        
                                        Client->>L2: Handshake + JWT
                                        activate L2
                                        L2-->>Client: ‚úì User attached
                                        deactivate L2
                                        
                                        Client->>L3: joinProjectRoom(123)
                                        activate L3
                                        L3-->>Client: ‚úì Joined room
                                        deactivate L3
                                </div>
                            </div>
                            <div style="flex: 1; text-align: center; background: rgba(16, 185, 129, 0.05); padding: 1em; border-radius: 8px;">
                                <h5 style="color: #10b981; margin-bottom: 0.8em;">üåê Widget Kh√°ch h√†ng</h5>
                                <div class="mermaid" style="font-size: 0.65em;">
                                    sequenceDiagram
                                        participant Client as Widget
                                        participant L1 as L·ªõp 1
                                        participant L2 as L·ªõp 2
                                        participant L3 as L·ªõp 3
                                        
                                        Client->>L1: K·∫øt n·ªëi (·∫©n danh)
                                        activate L1
                                        L1-->>Client: ‚úì Domain whitelisted
                                        deactivate L1
                                        
                                        Client->>L2: Handshake (no JWT)
                                        activate L2
                                        L2-->>Client: ‚úì Anonymous OK
                                        deactivate L2
                                        
                                        Client->>L3: identify(visitorUid)
                                        activate L3
                                        L3-->>Client: ‚úì Session created
                                        deactivate L3
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                <p><strong>Minh h·ªça ho·∫°t ƒë·ªông c·ªßa ki·∫øn tr√∫c 3 l·ªõp</strong></p>
                
                <p><strong>K·ªãch b·∫£n 1: Agent ƒêƒÉng nh·∫≠p</strong></p>
                <ol>
                    <li>Agent App g·ª≠i y√™u c·∫ßu k·∫øt n·ªëi t·ª´ app.our-domain.com v·ªõi JWT trong handshake.</li>
                    <li>L·ªõp 1 (Adapter) ki·ªÉm tra origin v√† x√°c nh·∫≠n OK v√¨ ƒë√¢y l√† domain ch√≠nh.</li>
                    <li>L·ªõp 2 (Guard) x√°c th·ª±c JWT, n·∫øu h·ª£p l·ªá s·∫Ω g·∫Øn th√¥ng tin user v√†o socket.</li>
                    <li>Agent g·ª≠i event "joinProjectRoom" v·ªõi projectId: 123.</li>
                    <li>L·ªõp 3 (Gateway) th√™m socket v√†o room "project:123", k·∫øt n·ªëi th√†nh c√¥ng v√† Agent c√≥ th·ªÉ nh·∫≠n/g·ª≠i d·ªØ li·ªáu c·ªßa d·ª± √°n n√†y.</li>
                </ol>
                
                <p><strong>K·ªãch b·∫£n 2: Widget c·ªßa Kh√°ch h√†ng</strong></p>
                <ol>
                    <li>Widget ƒë∆∞·ª£c nh√∫ng tr√™n customer.com g·ª≠i y√™u c·∫ßu k·∫øt n·ªëi v·ªõi projectId: 456.</li>
                    <li>L·ªõp 1 (Adapter) ki·ªÉm tra xem domain "customer.com" c√≥ trong danh s√°ch whitelist c·ªßa project 456 kh√¥ng. N·∫øu c√≥ ‚Üí OK.</li>
                    <li>L·ªõp 2 (Guard) ph√°t hi·ªán kh√¥ng c√≥ JWT trong handshake, nh∆∞ng cho ph√©p v√¨ ƒë√¢y l√† k·∫øt n·ªëi ·∫©n danh h·ª£p l·ªá.</li>
                    <li>Widget g·ª≠i event "identify" v·ªõi visitorUid: "abc-123".</li>
                    <li>L·ªõp 3 (Gateway) t·∫°o session cho visitor n√†y v√† k·∫øt n·ªëi th√†nh c√¥ng. Visitor c√≥ th·ªÉ b·∫Øt ƒë·∫ßu tr√≤ chuy·ªán.</li>
                </ol>
            </aside>
        </section>
      </section>

    </div>
  </div>
  
  <script>
    // Load scripts sau khi DOM ready
    window.addEventListener('DOMContentLoaded', () => {
      fetch('../shared/scripts.html')
        .then(r => r.text())
        .then(html => {
          document.body.insertAdjacentHTML('beforeend', html);
        });
    });
  </script>
</body>
</html>